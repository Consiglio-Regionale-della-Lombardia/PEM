@using PortaleRegione.DTO.Enum
@model PortaleRegione.DTO.Model.CommandRiepilogoModel
@{
    var require_my_sign = Convert.ToBoolean(HttpUtility.ParseQueryString(Request.Url.Query).Get("require_my_sign"));
}
<div class="row valign-wrapper">
    <div class="col s3 left">
        <label>
            <input type="checkbox" id="checkAll"/>
            <span for="checkAll">Seleziona tutti</span>
        </label>
    </div>
    <div class="col s5 left">
        @if ((User.IsInRole(RuoliExt.Consigliere_Regionale) || User.IsInRole(RuoliExt.Assessore_Sottosegretario_Giunta)) && Model.mode == ClientModeEnum.GRUPPI)
        {
            <label>
                <input type="checkbox" id="checkAllMy" onchange="filtraEM_RichiestaFirma(this.checked)" @Html.Raw(require_my_sign ? "checked=\"checked\"" : "")/>
                <span for="checkAllMy">Visualizza solo gli EM/SUBEM per i quali è richiesta la mia firma</span>
            </label>
        }
    </div>
    <div class="col s6">
        <div class="right">
            @if (Model.mode == ClientModeEnum.TRATTAZIONE)
            {
                if (!string.IsNullOrEmpty(Model.Atto.LinkFascicoloPresentazione) && Model.Atto.OrdinePresentazione == true)
                {
                    <a class="blue-text tooltipped" href="@Model.Atto.LinkFascicoloPresentazione" data-position="bottom" data-tooltip="Scarica fascicolo presentazione" target="">
                        <i class="material-icons">file_download</i>
                    </a>
                }
            }
            @if (Model.mode == ClientModeEnum.TRATTAZIONE)
            {
                if (!string.IsNullOrEmpty(Model.Atto.LinkFascicoloVotazione) && Model.Atto.OrdineVotazione == true)
                {
                    <a class="blue-text tooltipped" href="@Model.Atto.LinkFascicoloVotazione" data-position="bottom" data-tooltip="Scarica fascicolo votazione" target="">
                        <i class="material-icons">file_download</i>
                    </a>
                }
            }
            <a class="blue-text tooltipped" onclick="ConfirmStampa()" data-tooltip="Stampa" data-position="left">
                <i class="material-icons">print</i>
            </a>
            @{
                var text = "";
                var icon = "";
                var new_view = ViewModeEnum.GRID;

                if (Model.view == ViewModeEnum.PREVIEW)
                {
                    text = "Visualizza EM in griglia";
                    icon = "developer_board";
                }
                else if (Model.view == ViewModeEnum.GRID)
                {
                    new_view = ViewModeEnum.PREVIEW;
                    text = "Visualizza EM in preview";
                    icon = "desktop_windows";
                }
            }


            <a class="blue-text tooltipped" onclick="filtra_View('@new_view')" data-tooltip="@text" data-position="left">
                <i class="icon material-icons">@icon</i>
            </a>

        </div>
    </div>
</div>

<script>
    function filtraEM_RichiestaFirma(enable) {
        var url = '@Url.Action("RiepilogoEmendamenti", "Emendamenti", new { id = Model.Atto.UIDAtto, Model.mode, Model.view })';
        if (enable) {
            go(url + '&require_my_sign=true');
        } else {
            go(url + '&require_my_sign=false');
        }
    }

    $("#checkAll").click(function() {
        setSelezionaTutti(this.checked);
        setListaEmendamenti([]);
        $('input[id^="chk_EM_"]').not(this).prop('checked', this.checked);
        AbilitaComandiMassivi(null);
    });
</script>