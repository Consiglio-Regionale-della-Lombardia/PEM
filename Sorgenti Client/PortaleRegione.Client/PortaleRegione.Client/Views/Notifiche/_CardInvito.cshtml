
@using PortaleRegione.Common
@using PortaleRegione.DTO.Enum
@model PortaleRegione.DTO.Domain.NotificaDto
@{
    var titolo = string.Empty;
    var sub_titolo = string.Empty;
    if (Model.IsPem)
    {
        titolo = $"Seduta del {Model.EM.ATTI.SEDUTE.Data_seduta:dd/MM/yyyy}";
        var isSubEM = Model.EM.Rif_UIDEM.HasValue;
        var progressivo = Model.EM.Progressivo.Value;
        var title = "TEMP";
        if (isSubEM)
        {
            progressivo = Model.EM.SubProgressivo.Value;
            title = "SUBEM";
        }

        var displayRiferimentoTemporaneo = string.Empty;
        if (Model.EM.STATI_EM.IDStato >= (int) StatiEnum.Depositato)
        {
            displayRiferimentoTemporaneo = string.Format("(ex. {0} {1})", title, progressivo);
        }

        sub_titolo = $" - {Model.EM.ATTI.TIPI_ATTO.Tipo_Atto} {Model.EM.ATTI.NAtto} - <b>{Model.EM.N_EM} {displayRiferimentoTemporaneo}</b>";
    }
    else if (Model.IsDasi)
    {
        titolo = $"{Utility.GetText_TipoDASI(Model.ATTO_DASI.Tipo)} {Model.ATTO_DASI.NAtto}";
        sub_titolo = $" - {Model.ATTO_DASI.Oggetto}";
    }
}

<div class="collapsible-header" onclick="GetDestinatariNotifica(@Model.UIDNotifica)">
    <table>
        <tr style="border: unset">
            <td style="border: unset" width="5">
                @if (Model.IsPem)
                {
                    <div class="chip blue-text white" style="border: 1px solid #7EADF3; min-width: unset;">PEM</div>
                }
                else if (Model.IsDasi)
                {
                    <div class="chip red-text white" style="border: 1px solid #F4433C; min-width: unset;">DASI</div>
                }
            </td>
            <td style="border: unset">
                <label>
                    <b>@titolo</b>@Html.Raw(sub_titolo)
                </label>
            </td>
            <td style="border: unset; text-align: right; width: 10px">
                @{
                    var firmato_da_me = false;
                    if (Model.IsPem)
                    {
                        firmato_da_me = Model.EM.Firmato_Da_Me;
                    }
                    else if (Model.IsDasi)
                    {
                        firmato_da_me = Model.ATTO_DASI.Firmato_Da_Me;
                    }
                }

                @if (User.IsInRole(RuoliExt.Consigliere_Regionale) ||
                     User.IsInRole(RuoliExt.Assessore_Sottosegretario_Giunta))
                {
                    if (firmato_da_me)
                    {
                        <i class="icon material-icons green-text tooltipped" data-tooltip="Firmato">check</i>
                    }
                    else
                    {
                        <i class="icon material-icons blue-text tooltipped" data-tooltip="Richiesta firma">query_builder</i>
                    }
                }
            </td>
        </tr>
    </table>

</div>
<div class="collapsible-body">
    <div class="row" style="margin-bottom: unset !important; margin-top: unset !important;">
        <div class="col s6">
            <div class="row" style="margin-bottom: unset !important; margin-top: unset !important;">
                <div class="col s12">
                    <h5>Mittente</h5>
                    <hr/>
                    <div class="chip" style="min-width: unset">
                        <img src="http://intranet.consiglio.regione.lombardia.it/GC/foto/@Model.UTENTI_NoCons.foto" alt="@Model.UTENTI_NoCons.DisplayName">
                        @Model.UTENTI_NoCons.DisplayName_GruppoCode
                    </div>
                </div>

                <div class="col s12">
                    <label>Invito a firmare</label>
                    @if (Model.IsPem)
                    {
                        <div class="form-group">
                            <p>
                                <b>@Model.EM.N_EM</b>
                            </p>
                            <h6>@Utility.MetaDatiEM_Label(Model.EM)</h6>
                            <label>
                                <b>Scadenza Presentazione EM:</b> @Model.EM.ATTI.SEDUTE.Scadenza_presentazione.Value.ToString("dd/MM/yyyy HH:mm")
                            </label>
                        </div>
                        <div class="form-group" style="margin-top: 20px">
                            @if (Model.EM.Firmabile)
                            {
                                <a class="btn-flat green-text" onclick="RevealFirmaDeposito('@Model.EM.UIDEM', @Html.Raw((int) ActionEnum.FIRMA))">
                                    <i class="material-icons right green-text">gavel</i>
                                    FIRMA
                                </a>
                            }

                            <a class="btn-flat blue-text" onclick="go('@Url.Action("ViewEmendamento", "Emendamenti", new {id = Model.UIDEM, notificaId = Model.UIDNotifica})')">
                                <i class="material-icons right">chevron_right</i>
                                Vedi EM
                            </a>
                        </div>
                    }
                    else if (Model.IsDasi)
                    {
                        <div class="form-group">
                            <p>
                                <b>@titolo</b>
                            </p>
                            <p>
                                @Model.ATTO_DASI.Oggetto
                            </p>
                        </div>
                        <div class="form-group" style="margin-top: 20px">
                            @if (Model.ATTO_DASI.Firmabile)
                            {
                                <a class="btn-flat green-text" onclick="RevealFirmaDepositoDASI('@Model.ATTO_DASI.UIDAtto', @Html.Raw((int) ActionEnum.FIRMA))">
                                    <i class="material-icons right green-text">gavel</i>
                                    FIRMA
                                </a>
                            }

                            <a class="btn-flat blue-text" onclick="go('@Url.Action("ViewAtto", "DASI", new {id = Model.ATTO_DASI.UIDAtto})')">
                                <i class="material-icons right">chevron_right</i>
                                Vedi Atto
                            </a>

                        </div>
                    }

                </div>
            </div>
        </div>
        <div class="col s6">
            <div class="row" style="margin-bottom: unset !important; margin-top: unset !important;">
                <div class="col s12">
                    @Html.Partial("_CardInvito_Destinatari", Model.UIDNotifica)
                </div>
            </div>
        </div>
    </div>
</div>