@using PortaleRegione.DTO.Enum
<script>
    var instanceModalDasi;

    function SalvaDasi() {

        var form_data = new FormData();
        form_data.append("Oggetto", $('textarea[id="modalOggettoDasi"]').val());
        form_data.append("Tipo", $('input[id="hdTipoAttoDasi"]').val());
        form_data.append("Testo", $('textarea[id="modalTestoDasi"]').val());
        form_data.append("IDTipo_Risposta", $('select[id="modalTipoDasi"]').children("option:selected").val());

        $.ajax({
            url: baseUrl + "/dasi",
            type: "POST",
            data: form_data,
            processData: false,
            contentType: false
        }).done(function(data) {
            console.log(data);
            
                swal({
                    title: "Procedura completata",
                    text: "Atto inserito correttamente a sistema.",
                    icon: "success",
                    buttons: ["Ok", "Vai al riepilogo"]
                }).then((value) => {
                    if (value) {
                        go(baseUrl + data);
                    } else
                        instanceModalDasi.close();
                });
            
        }).fail(function(err) {
            console.log("error", err);
            ErrorAlert(err.message);
        });
    }

    function openFormDASI(tipo, edit) {
        var tipo_dasi = tipo;
        var title = GetTitle(tipo, edit);
        $('#hdTipoAttoDasi').val(tipo);
        $('#titleDasiModal').text(title);
        $('select').formSelect();
        var elemAutocomplete = document.querySelector('#autocompleteSoggettoDestinatarioDasi');

        var autocompleteDataOptions = {
            data: [
                { tag: 'I Commissione permanente - Economia e Bilancio', id: '1' },
                { tag: 'II Commissione', id: '2' },
                { tag: 'III Commissione', id: '3' }
            ],
            limit: 10,
            minLength: 1
        };
        M.Chips.init(elemAutocomplete,
            {
                autocompleteOptions: autocompleteDataOptions,
                onChipAdd: function(e, chip) {
                },
                onChipSelect: function(e, chip) {
                },
                onChipDelete: function(e, chip) {
                }
            });
        var elemModal = document.querySelector("#modalAggiungiDASI");
        var options = {
            dismissible: false
        };
        instanceModalDasi = M.Modal.init(elemModal, options);
        instanceModalDasi.open();
    }

    function GetTitle(tipo_dasi, edit) {
        var prefix = edit ? "Modifica" : "Nuovo";
        if (tipo_dasi == @Html.Raw((int)TipoAttoEnum.ITL)) {
            return prefix + " ITL";
        }else if (tipo_dasi == @Html.Raw((int)TipoAttoEnum.ITR)) {
            return prefix + " ITR";
        }else if (tipo_dasi == @Html.Raw((int)TipoAttoEnum.IQT)) {
            return prefix + " IQT";
        }else if (tipo_dasi == @Html.Raw((int)TipoAttoEnum.MOZ)) {
            return prefix + " MOZ";
        }else if (tipo_dasi == @Html.Raw((int)TipoAttoEnum.ODG)) {
            return prefix + " ODG";
        }
    }
</script>