@using Newtonsoft.Json
@using PortaleRegione.Client.Helpers
@using PortaleRegione.DTO.Domain
@model PortaleRegione.DTO.Model.RiepilogoDASIModel
<script>
    $('#btnSearch').on("click",
        async function() {
            openDasiSearch();
        });

    var sedute = [];
    var seduteMOZU = [];
    var templateSeduteAttive = "<li class='collection-item'><div><p><label><input name='gruppoSeduteAttive' type='radio' value='{VALUE}' {CHECKED}/><span>{TEXT}</span></label></p></div></li>";

    $(window).on('load',
        async function() {
            if (sedute.length == 0) {
                var data = await GetSeduteAttive();
                sedute = data.Results;
            }
            if (seduteMOZU.length == 0) {
                var data = await GetSeduteAttiveMOZU();
                seduteMOZU = data.Results;
            }
        });

    $(document).ready(async function() {
        setSelezionaTutti_DASI(false);
        checkSelectedDASI();
    });

    function DeclassaMozione(uidAtto) {
        var nome_atto = $('#atto_' + uidAtto).data("nome-atto");
        swal("Verranno rimosse dall'atto " + nome_atto + " urgenza/abbinamento. Sei sicuro?",
            {
                buttons: {
                    cancel: "Annulla",
                    confirm: {
                        className: "red white-text",
                        title: "Rimuovi urgenza/abbinamento",
                        value: true
                    }
                }
            }).then((value) => {
            if (value == true) {
                var url = '@Url.Action("DeclassaMozione", "DASI")';
                var mozs = [];
                mozs.push(uidAtto);
                $.ajax({
                    url: url,
                    type: "POST",
                    data: JSON.stringify(mozs),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json"
                }).done(function(result) {

                    location.reload();

                }).fail(function(err) {
                    console.log("error", err);
                    Error(err);
                });
            }
        });
    }

    window.addEventListener("message", (event) => {
	    // Controlla l'origine del messaggio per motivi di sicurezza
	    if (event.origin !== "@AppSettingsConfiguration.URL_CLIENT") { // sostituisci con il tuo dominio
		    return;
	    }

	    if (event.data === "aggiornaPadre") {
		    location.reload(); // Ricarica la pagina padre
	    }
    }, false);
</script>